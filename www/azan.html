<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Azaan Player (Local with Adjustments)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body {
      margin:0; font-family: Arial, sans-serif; color: #fff; text-align:center;
      background: url('background.jpg') center / cover no-repeat fixed;
      display:flex; flex-direction:column; min-height:100vh;
      background-color: #000;
    }
    .overlay {
      background: rgba(0,0,0,0.45);
      padding: 18px; margin: 20px auto; border-radius: 12px;
      width: 90%; max-width:900px;
      box-sizing: border-box;
      box-shadow: 0 8px 24px rgba(0,0,0,0.6);
    }
    h1 { margin: 8px 0 12px; font-size: 26px; text-shadow: 1px 1px 4px #000; }
    .times { font-size:18px; text-align:left; line-height:1.6; margin-bottom:10px; }
    .controls { margin-top:12px; }
    button { padding:10px 14px; font-size:16px; border-radius:8px; border:0; margin:6px; }
    #hadith-box { margin-top:14px; height:90px; overflow:hidden; border-radius:8px; background: rgba(0,0,0,0.55); display:flex; align-items:center; justify-content:center; padding:10px; }
    #hadith-text { font-size:16px; line-height:1.4; }
    #unlock { background:#0b7; color:#003; font-weight:700; }
    #play { background:#06f; color:#fff; }
    .adjustments { margin-top:15px; background: rgba(0,0,0,0.4); padding:10px; border-radius:8px; font-size:15px; text-align:left; }
    .adjustments label { display:block; margin:4px 0; }
    .adjustments input { width:60px; }
  </style>
</head>
<body>
  <div class="overlay">
    <h1>Azaan Player</h1>
    <div id="status">Tap <strong>Unlock Audio</strong> once when the page loads (required on iOS Safari).</div>
    <div id="prayer-times" class="times">Loading prayer times...</div>

    <div class="controls">
      <audio id="azan" src="azan.mp3"></audio>
      <button id="unlock">Unlock Audio</button>
      <button id="play">‚ñ∂ Play Azaan</button>
      <button id="stop">‚èπ Stop</button>
    </div>

    <div class="adjustments">
      <strong>Adjustments (minutes):</strong><br>
      <label>Fajr: <input type="number" id="adj-Fajr" value="0"></label>
      <label>Dhuhr: <input type="number" id="adj-Dhuhr" value="0"></label>
      <label>Asr: <input type="number" id="adj-Asr" value="0"></label>
      <label>Maghrib: <input type="number" id="adj-Maghrib" value="0"></label>
      <label>Isha: <input type="number" id="adj-Isha" value="0"></label>
      <button id="save-adj">üíæ Save Adjustments</button>
    </div>

    <div id="hadith-box"><div id="hadith-text">Loading Hadith...</div></div>
  </div>

<script>
(function(){
  var audio = document.getElementById('azan');
  var unlockBtn = document.getElementById('unlock');
  var playBtn = document.getElementById('play');
  var stopBtn = document.getElementById('stop');
  var status = document.getElementById('status');
  var prayerDiv = document.getElementById('prayer-times');

  unlockBtn.addEventListener('click', function() {
    audio.play(); audio.pause();
    status.innerHTML = 'Audio unlocked. Automatic Azaan will play after you press Play once.';
  });
  playBtn.addEventListener('click', function() { audio.play(); });
  stopBtn.addEventListener('click', function() { audio.pause(); audio.currentTime = 0; });

  // Embedded hadiths
  var hadiths = [
    {source: "Sahih Bukhari", text: "The best of you are those who have the best character."},
    {source: "Sahih Muslim", text: "Make things easy for people and do not make them difficult."},
    {source: "Bukhari & Muslim", text: "Whoever believes in Allah and the Last Day, let him speak good or remain silent."},
    {source: "Bukhari", text: "The strong man is not the one who overcomes people by his strength, but the one who controls himself while in anger."},
    {source: "Tirmidhi", text: "Actions are judged by intentions."},
    {source: "Ibn Majah", text: "Whoever removes a worldly grief from a believer, Allah will remove from him one of the griefs of the Day of Judgement."},
    {source: "Nasai", text: "None of you truly believes until he loves for his brother what he loves for himself."},
    {source: "Ahmad", text: "The best charity is that given when you are rich and healthy."}
  ];
  var hadithIndex = 0;
  function showHadith(){
    var h = hadiths[hadithIndex];
    document.getElementById('hadith-text').textContent = (h.source?('['+h.source+'] '):'') + h.text;
    hadithIndex = (hadithIndex + 1) % hadiths.length;
  }
  showHadith();
  setInterval(showHadith, 15000);

  function getJSON(url, cb, errcb) {
    var xhr = new XMLHttpRequest();
    xhr.open('GET', url, true);
    xhr.onreadystatechange = function() {
      if (xhr.readyState === 4) {
        if (xhr.status === 200) {
          try { cb(JSON.parse(xhr.responseText)); } catch(e) { if (errcb) errcb(e); }
        } else { if (errcb) errcb(xhr.status); }
      }
    };
    xhr.send();
  }

  var city = 'London', country = 'united kingdom';
  var adjustments = JSON.parse(localStorage.getItem('prayerAdjustments') || '{}');

  function applyAdjustmentsToInputs(){
    ['Fajr','Dhuhr','Asr','Maghrib','Isha'].forEach(function(p){
      var el = document.getElementById('adj-'+p);
      if (adjustments[p] !== undefined) el.value = adjustments[p];
    });
  }
  applyAdjustmentsToInputs();

  document.getElementById('save-adj').addEventListener('click', function(){
    ['Fajr','Dhuhr','Asr','Maghrib','Isha'].forEach(function(p){
      var val = parseInt(document.getElementById('adj-'+p).value,10);
      adjustments[p] = isNaN(val)?0:val;
    });
    localStorage.setItem('prayerAdjustments', JSON.stringify(adjustments));
    status.innerHTML = "Adjustments saved. Times will update.";
    loadPrayerTimes();
  });

  function loadPrayerTimes() {
    var today = new Date();
    var y = today.getFullYear(), m = today.getMonth()+1, d = today.getDate();
    var dateStr = y + '-' + (m<10?('0'+m):m) + '-' + (d<10?('0'+d):d);

    // MuslimSalat API (replace YOUR_API_KEY with your actual key)
var url = 'https://muslimsalat.com/' 
            + encodeURIComponent(city) 
            + '.json?key=1f7233fbce83a6401549b4598f753073';
  
     

    getJSON(url, function(resp){
      try {
        var times = resp.items[0];
        var html = '';
        ['Fajr','Dhuhr','Asr','Maghrib','Isha'].forEach(function(name){
          var t = adjustTime(times[name.toLowerCase()], adjustments[name]||0);
          html += name + ': ' + t + '<br>';
        });
        prayerDiv.innerHTML = html;
        scheduleAzan(times);
      } catch(e) { prayerDiv.innerHTML = 'Prayer times error.'; }
    }, function(){ prayerDiv.innerHTML = 'Could not fetch prayer times.'; });
  }

  function adjustTime(timeStr, offsetMinutes){
    if (!timeStr) return "--:--";
    var parts = timeStr.split(':');
    var hh = parseInt(parts[0],10), mm = parseInt(parts[1],10);
    var dt = new Date();
    dt.setHours(hh); dt.setMinutes(mm); dt.setSeconds(0);
    dt = new Date(dt.getTime() + offsetMinutes*60000);
    var h = dt.getHours(), m = dt.getMinutes();
    return (h<10?'0'+h:h)+':' + (m<10?'0'+m:m);
  }

  var scheduled = [];
  function scheduleAzan(times) {
    scheduled.forEach(function(id){ clearTimeout(id); });
    scheduled = [];
    var now = new Date();
    ['Fajr','Dhuhr','Asr','Maghrib','Isha'].forEach(function(name){
      var t = times[name.toLowerCase()] || "00:00";
      var parts = t.split(':');
      var hh = parseInt(parts[0],10), mm = parseInt(parts[1],10);
      var prayerTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hh, mm);
      var offset = adjustments[name]||0;
      prayerTime = new Date(prayerTime.getTime() + offset*60000);
      if (prayerTime <= now) return;
      var delay = prayerTime.getTime() - Date.now();
      var id = setTimeout(function(){
        try { audio.play(); } catch(e) {}
        status.innerHTML = "It's time for " + name + " (" + prayerTime.toLocaleTimeString() + ')';
      }, delay);
      scheduled.push(id);
    });
  }

  setInterval(loadPrayerTimes, 1000*60*60);
  loadPrayerTimes();
})();
</script>
</body>
</html>
